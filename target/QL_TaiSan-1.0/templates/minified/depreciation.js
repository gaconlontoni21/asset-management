import{getFormData as t,showErrorMessage as e,reloadNumRecords as a,sendRequest as i,getCurrentResource as n,getURL as o,showErrorChildModal as d}from"./common.js";export function chooseItemFromDropdownMenu(){$("body").on("click",".modal .dropdown-item:not(.table-item)",function(){let t=$(this).parent().prev().attr("action"),r=$('input.action[action="searchDepreciationMethod"]').attr("data-value");if("searchDepreciationMethod"!==t&&""===r)return d("Vui l\xf2ng chọn phương ph\xe1p khấu hao trước"),!1;var c=$(this).find("span").first().attr("data-value"),p=$(this).find("span").eq(1).attr("data-value"),l=$(this).parent(),u=$(l).prev();if($(u).attr("data-value",c),$(u).val(p),l.find(".dropdown-item").detach(),l.removeClass("show"),"true"===l.attr("getDepreciationDetailList")){let s=n()+"/view?action=getDepreciationDetailList&key="+c;i(o(s),"GET",{},"text",function(t){$(".modal .table tbody tr:not(.table-item)").detach();var e=$(t).find("table tbody tr:not(.table-item)");e.appendTo($(".modal .table tbody")),a(e,"#modalNumRecords")},function(t){e(t.responseText)})}})}export function getData(){let e=t("#save-form");e.id=""===e.id?null:e.id,e.creatorId=$('input[name="creatorId"]').attr("data-value"),e.accountingPeriodId=$('input[name="accountingPeriodId"]').attr("data-value"),e.depreciationMethodId=$('input[name="depreciationMethodId"]').attr("data-value"),e.totalValue=0,e.periodDepreciationExpense=0,e.accumulatedDepreciation=0,e.remainingValue=0;let a={depreciationDetailList:[]};return $(".modal .table tbody tr:not(.emptyRow)").each(function(){let t=$(this),i=t.find("td").eq(0).text(),n=t.find("td").eq(3).text(),o=t.find("td").eq(4).text(),d=t.find("td").eq(5).text(),r=t.find("td").eq(6).text(),c=t.find("td").eq(7).text(),p=t.find("td").eq(8).text();e.totalValue+=parseInt(d),e.periodDepreciationExpense+=parseInt(r),e.accumulatedDepreciation+=parseInt(c),e.remainingValue+=parseInt(p),a.depreciationDetailList.push({depreciationId:e.id,assetId:i,depreciationPeriod:n,percentageDepreciation:o,totalValue:d,periodDepreciationExpense:r,accumulatedDepreciation:c,remainingValue:p})}),e.depreciationDetailList=a.depreciationDetailList,e}